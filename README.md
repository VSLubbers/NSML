# NSML — Neuro-Symbolic Markup Language

**NSML (Neuro-Symbolic Markup Language)** is a declarative, XML-like formalism and parser implemented in TypeScript.  
It enables deterministic symbolic reasoning within systems that rely on Large Language Models (LLMs), providing a structured interface between neural and rule-based computation.

NSML is designed for embedding in hybrid reasoning pipelines, where LLMs generate or interpret symbolic representations that require verifiable execution.

## Overview

| Aspect | Description |
|---------|--------------|
| **Language type** | Declarative markup (neuro-symbolic DSL) |
| **Primary use** | Structured reasoning, rule evaluation, symbolic inference |
| **Implementation** | TypeScript (Node.js and browser compatible) |
| **Size** | ~44 KB (minified) |
| **License** | Apache 2.0 |
| **Status** | Core parser stable, documentation and domain extensions in progress |


## Installation

```bash
npm install nsml
````

## Basic Example

```ts
import { parseNSML } from "nsml";

const code = `
<nsml version="1.0">
  <symbols>
    <var name="age" type="number">42</var>
    <const name="adultThreshold" type="number">18</const>
  </symbols>
  <rules>
    <rule name="isAdult">age >= adultThreshold => true</rule>
  </rules>
  <queries>
    <query name="checkAdult">eval(isAdult)</query>
  </queries>
</nsml>
`;

const result = parseNSML(code);
console.log(result);
```

Output:

```json
{
  "checkAdult": { "result": true },
  "trace": [...]
}
```



## Motivation

LLMs are effective at semantic association and natural language generation but lack deterministic logical consistency.
NSML addresses this limitation by separating **symbolic reasoning** from **neural generation**, enabling LLMs to produce verifiable logical structures that can be executed independently.

This design facilitates:

* Deterministic evaluation of reasoning steps generated by models
* Transparent traceability and verifiability of inferences
* Integration of rule-based systems within neural pipelines


## Language Structure

### Core Elements

| Element            | Purpose                                        |
| ------------------ | ---------------------------------------------- |
| `<nsml>`           | Root element defining a reasoning document     |
| `<symbols>`        | Variable, constant, set, or graph declarations |
| `<rules>`          | Logical or functional relations                |
| `<queries>`        | Evaluation or retrieval operations             |
| `<assertions>`     | Consistency and invariant checks               |
| `<counterfactual>` | Alternative conditional scopes                 |
| `<simulate>`       | Stepwise symbolic reasoning traces             |
| `<import>`         | Modular logic importation                      |

### Example

```xml
<nsml>
  <symbols>
    <set name="numbers" elements="1,2,3,4,5" />
  </symbols>
  <queries>
    <exists in="numbers" condition="> 3" count="true" />
  </queries>
</nsml>
```

Result:

```json
{ "exists": { "result": true, "count": 2 } }
```


## Syntax and Semantics

* Tags follow XML-style notation with key-value attributes.
* Expressions use a simplified logical syntax (`&&`, `||`, `!`, `=>`, `<`, `>`, `==`).
* Execution is declarative: NSML describes *what* to evaluate, not *how*.
* Each rule and query is internally compiled to a typed, verifiable function.


## System Architecture

| Stage         | Module         | Description                              |
| ------------- | -------------- | ---------------------------------------- |
| **Lexer**     | `lexer.ts`     | Tokenizes NSML input into lexical units  |
| **Parser**    | `parser.ts`    | Constructs an abstract syntax tree (AST) |
| **Resolver**  | `resolver.ts`  | Builds symbol and dependency tables      |
| **Compiler**  | `compiler.ts`  | Converts rules into executable functions |
| **Evaluator** | `evaluator.ts` | Executes queries and assertions          |
| **Domains**   | `domains.ts`   | Optional domain-specific logic handlers  |

Each module can be imported and extended individually.


## Integration in LLM Pipelines

**Example reasoning loop:**

**Prompt:**

> Alice is Bob’s parent. All parents are adults. Is Alice an adult?

**LLM Output:**

```xml
<nsml>
  <symbols>
    <entity name="Alice" props="age=30" />
    <entity name="Bob" props="age=10" />
    <graph name="family" nodes="Alice,Bob" edges="Alice->parentOf->Bob" />
  </symbols>
  <rules>
    <rule name="adult">item.age >= 18</rule>
    <rule name="parentImplication">parentOf(x, y) => eval(adult(x))</rule>
  </rules>
  <queries>
    <query name="checkAliceAdult">eval(adult(Alice))</query>
  </queries>
</nsml>
```

**Execution Result:**

```json
{ "checkAdult": { "result": true } }
```

This pattern supports closed-loop neuro-symbolic reasoning where the LLM acts as a generator, and NSML provides deterministic evaluation and correction feedback.

## API Reference

### `parseNSML(input: string): EvalResult`

Executes a full parse and evaluation cycle.

**EvalResult interface:**

```ts
interface EvalResult {
  results: Record<string, any>;
  errors: { type: string; message: string; suggestedFix?: string }[];
  trace?: string[];
}
```

### Lower-level API

```ts
lex(input)           // Tokenize input
parse(tokens)        // Construct AST
resolve(ast)         // Bind symbols and rules
evaluate(ast)        // Execute logic and queries
registerDomain(tag, handler) // Extend with domain logic
```


## Repository Structure

```
NSML/
├── src/
│   ├── lexer.ts
│   ├── parser.ts
│   ├── resolver.ts
│   ├── compiler.ts
│   ├── evaluator.ts
│   ├── domains.ts
│   └── index.ts
├── tests/
├── examples/
├── docs/
│   ├── language-spec.md
│   ├── architecture.md
│   ├── integration-guide.md
│   ├── llm-guide.md
│   └── examples.md
└── README.md
```

## Development Status

* Core parsing and evaluation completed
* Domain hook architecture implemented
* Documentation and integration guides in progress
* Planned: visual trace viewer and RDF/graph bridges


## License

Apache License 2.0
© 2025 V. S. Lubbers


## Citation

If used for academic or applied research:

```
Lubbers, V. S. (2025). Neuro-Symbolic Markup Language (NSML): 
A Lightweight Declarative Bridge for LLM Reasoning.
GitHub repository: https://github.com/VSLubbers/NSML
```